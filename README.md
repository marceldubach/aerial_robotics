# Hardware practicals
Aerial robotics - MICRO 502, EPFL
---
Note:
- the python script of our implementation is located in crazyfly-lib-python/dev/crazypractical.py
- run the script inside the crazyfly-lib-python directory using the command python dev/crazypractical.py

## Project description

The aim of this project is the following: a Crazyflie (10cmx10cm drone) and a box (30cmx30cmx10cm) are placed
on a square map (1.2mx1.2m). The drone must be able to detect the box without knowing its position a priori and then
proceed to land on it.

## Our method

The implemented strategy to perform the given task is the
following: the drone first takes off and follows a pre-defined
trajectory, by reaching a list of waypoints one after the other in a given order. When it
reaches a waypoint, the drone pauses to stabilize before
moving again and to run onboard our **box detection algorithm** (ref. next section).

We chose to move only along the x- and y-axis, and not in diagonal because flying perpendicular to the box edges simplifies the computation of the landing position. We chose to implement a small number of waypoints to keep the motion as simple as possible.

## Box detection algorithm

(See image 'edge_detection.jpg')

When the drone flies over the box, a sudden change is detected in the
relative altitude estimation, therefore the controller tries to compensate and the drone starts oscillating vertically.

In order to detect an edge, the drone computes the product of stored
z-position estimations and a shifted versions of a single period of a
sinus function. This is a cross-correlation between two signals. The period of the sinus is chosen as the measured period of
oscillations generated by the drone moving over an edge. The resulting cross-correlation signal
has a maximum for the shifting value at which both signals match each other
the most. In our case, we aim to detect a raising edge of the box and therefore the oscillations in the z-position estimation and the sinus have opposite phases, so we look for the minimum value of the cross-correlation. We are able to reliably detect where in the altitude signal there might have been oscillations of the particular frequency we are interested in. As noise could also generate oscillations in the signal, we enforced the detection by setting a upper threshold on the acceptable value of the cross-correlation for it to be considered an edge.

The drone stores its position estimations in each segment of the trajectory. Once a waypoint is reached, it pauses and
processes the currently stored z-position estimations, and then it resets the stored estimations.

This signal processing technique allows to retrieve the position at which the oscillations occured and therefore the position
of an edge of the box. Since the dimensions of the box are known in advance and as it is placed in the same orientation as the map, the centering procedure is purely geometrical. We can compute the center of the box in the moving direction.


As the drone’s motion is always along the map axes, the drone always detects
the box edges orthogonally and therefore, we know that by moving the
drone at 90 degrees to either left or right, it will be able to detect
another edge, orthogonally again! We move the drone around 20 cm in the
left direction. As the box has edges of 30 cm, the drone either leaves
the box, or stays on it. It then comes back 20 cm in the other
direction. If it detects an edge, it knows the precise location of the
center, and if it does not encounter one, it simply lands in the middle
of this 20 cm segment (because we know that no edge was detected along
it, so it’s safe to land).
The drone can then land in the center of the box.

## Summary

In summary, the drone follows a pre-planned trajectory where we ensured
that the box would be detected, no matter its exact position. Once it
detects an edge of the box, it moves in a direction allowing it to
detect a second edge (along the other axis) to then be able to estimate
the position of the center of the box and to land precisely on it.

## Authors
[Eric Bergkvist](https://github.com/ericbergkvist), Marcel Dubach, [Samuele Lanzanova](https://github.com/SamueleLanzanova), [Lorenzo Panchetti](https://github.com/PanchettiLorenzo)
